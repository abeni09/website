(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{884:function(e,t,r){"use strict";r.r(t);var o=r(307),n=r(297),l=r(304),c=r(793),d=r(848),h=r(868),m=r(794),f=r(296),U=r(792),v=r(809),w=r(789),D=r(776),_=(r(45),r(29),r(306),r(21)),C=(r(61),r(9),r(48),r(73),r(3),r(46),r(79),r(836)),k=r(851),x=r(879),S=r(312),F=r.n(S),y={mounted:function(){var e=localStorage.getItem("token"),t=localStorage.getItem("serverURL");if(e){var r=F.a.decode(e);console.log(t),r?(this.currentUser=r,"Admin"==r.role?this.userHasPermission=!0:this.userHasPermission=!1,this.userHasPermission?t?(this.server_url=t,this.fetchUsers(),this.loading=!1):(console.log("Invalid setting token."),this.$store.dispatch("auth/logout")):this.$router.push("/")):(console.log("Invalid JWT token."),this.$store.dispatch("auth/logout"))}else console.log("JWT token not found."),this.$store.dispatch("auth/logout")},data:function(){return{server_url:null,showSupervisorSelect:!1,currentUser:null,userHasPermission:!1,loading:!0,minDate:Object(k.a)(new Date,1),searchColumn:"name",User:[],search:"",filteredUser:[],potOptions:[],roleOptions:["Admin","Agent","Banker"],headers:[{text:"Name",value:"name"},{text:"Phone",value:"phone"},{text:"Email",value:"email"},{text:"Role",value:"role"},{text:"Added",value:"addedAt"},{text:"",value:"actions",sortable:!1}],confirmDeleteDialog:!1,confirmCloseDialog:!1,editUserMode:!1,addDialog:!1,addFormValid:!1,newUser:{name:"",phone:null,email:null,company:null,location:null,role:null},rules:{required:function(e){return!!e||"*Required."},email:function(e){return/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(e)||"Invalid email"}}}},watch:{search:function(e){var t=this;this.filteredUser=""===e?this.User:this.User.filter((function(r){var o=r[t.searchColumn];return o&&o.toString().toLowerCase().includes(e.toString().toLowerCase())}))}},methods:{fetchUsers:function(){var e=this;return Object(_.a)(regeneratorRuntime.mark((function t(){var r,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,fetch("".concat(e.server_url,"/fetchUsers"),{method:"GET",headers:{"Content-Type":"application/json"}});case 4:if((r=t.sent).ok){t.next=7;break}throw new Error("HTTP error! Status: ".concat(r.status));case 7:return t.next=9,r.json();case 9:data=t.sent,e.User=data.users,e.filteredUser=e.User,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(1),console.error("Error fetching users:",t.t0),e.setSnackbarMessage(t.t0);case 18:e.loading=!1;case 19:case"end":return t.stop()}}),t,null,[[1,14]])})))()},handleRoleChange:function(){this.showSupervisorSelect="Admin"!=this.newUser.role},formatDate:function(e){return Object(x.a)(new Date(e),"MMM dd, yyyy")},editUser:function(e){this.editUserMode=!0,this.newUser.name=e.name,this.newUser.email=e.email,this.newUser.id=e.id,this.newUser.role=e.role,"Supervisor"==this.newUser.role?(this.newUser.phone=e.phone,this.showSupervisorSelect=!0):"Admin"==this.newUser.role&&(this.newUser.phone=null,this.newUser.location=null,this.showSupervisorSelect=!1),this.showUserForm()},deleteUser:function(e){this.confirmDeleteUser(e)},closeUser:function(e){this.confirmCloseUser(e)},showAddUserForm:function(){this.editUserMode=!1,this.newUser={name:"",phone:null,email:null,company:null,location:null,role:null},this.showUserForm()},showUserForm:function(){this.UserFormValid=!1,this.addDialog=!0},closeUserForm:function(){this.addDialog=!1,this.$refs.UserForm.reset(),this.editUserMode=!1},saveUser:function(){if(this.$refs.UserForm.validate()){firebase.database();if(this.editUserMode)this.newUser.name,this.newUser.phone,this.newUser.email,this.newUser.role,Date.now(),this.currentUser.userId;else this.newUser.name,this.newUser.phone,this.newUser.email.toLowerCase(),this.newUser.role,Date.now(),this.currentUser.uid}},confirmDeleteUser:function(e){this.UserToDelete=e,this.confirmDeleteDialog=!0},confirmCloseUser:function(e){this.UserToClose=e,this.confirmCloseDialog=!0},confirmDelete:function(){var e=this;this.UserToDelete&&firebase.database().ref("Users").child(this.UserToDelete.id).remove().then((function(){e.confirmDeleteDialog=!1,e.filteredUser=e.User.filter((function(t){return t.id!==e.UserToDelete.id}))})).catch((function(e){console.error("Error deleting User from Firebase:",e)}))},cancelDelete:function(){this.closeDeleteDialog()},closeDeleteDialog:function(){this.confirmDeleteDialog=!1,this.UserToDelete=null},confirmClose:function(){var e=this;this.UserToClose&&firebase.database().ref("User").child(this.UserToClose.id).update({status:"Closed",closedAt:Date.now()}).then((function(){e.confirmCloseDialog=!1})).catch((function(e){console.error("Error closing User:",e)}))},cancelClose:function(){this.closeCloseDialog()},closeCloseDialog:function(){this.confirmCloseDialog=!1,this.UserToClose=null},exportToExcel:function(){var data=this.filteredUser.map((function(e){return{Name:e.name,Email:e.email,Location:e.location,Phone:e.phone,Role:e.role,"Added At":e.addedAt}})),e=C.a.json_to_sheet(data),t=C.a.book_new();C.a.book_append_sheet(t,e,"User"),Object(C.b)(t,"User.xlsx")},showAddForm:function(){this.newUser={name:null,phone:null,location:null,email:null,role:null},this.addDialog=!0},closeAddForm:function(){this.addDialog=!1,this.$refs.UserForm.reset(),this.newUser={name:"",phone:null,location:null,email:null,role:null}}}},A=r(100),component=Object(A.a)(y,(function(){var e=this,t=e._self._c;return e.userHasPermission?t("div",[t("div",{staticClass:"my-5",staticStyle:{display:"flex",margin:"auto"}},[t(U.a,[t(c.a,{attrs:{align:"center",cols:"12",md:"4",sm:"4"}},[t(v.a,{attrs:{outlined:"",dense:"",items:e.headers,label:"Column"},model:{value:e.searchColumn,callback:function(t){e.searchColumn=t},expression:"searchColumn"}})],1),e._v(" "),t(c.a,{attrs:{align:"center",cols:"12",md:"6",sm:"6"}},[t(D.a,{attrs:{dense:"",outlined:"","append-icon":"mdi-magnify",label:"Search","single-line":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),t(c.a,{attrs:{align:"center",cols:"12",md:"2",sm:"2"}},[e.userHasPermission?t(o.a,{staticStyle:{"background-color":"#183D0E",color:"#FFC72C"},on:{click:e.showAddUserForm}},[e._v("Add")]):e._e()],1)],1)],1),e._v(" "),t(d.a,{attrs:{loading:e.loading,headers:e.headers,items:e.filteredUser,search:e.search},scopedSlots:e._u([{key:"item.actions",fn:function(r){var n=r.item;return[t(o.a,{staticClass:"ma-1",attrs:{fab:"",small:"",inline:""}},[t(f.a,{attrs:{color:"green"},on:{click:function(t){return e.editUser(n)}}},[e._v("mdi-pencil")])],1),e._v(" "),t(o.a,{staticClass:"ma-1",attrs:{fab:"",small:"",inline:""}},[t(f.a,{attrs:{color:"red"},on:{click:function(t){return e.deleteUser(n)}}},[e._v("mdi-delete")])],1)]}}],null,!1,153749981)}),e._v(" "),t(h.a,{attrs:{"max-width":"600px"},model:{value:e.addDialog,callback:function(t){e.addDialog=t},expression:"addDialog"}},[t(n.a,[t(l.d,{staticClass:"headline centered-title",staticStyle:{"background-color":"aliceblue","margin-bottom":"1%"}},[e._v("\n            "+e._s(e.editUserMode?"Edit User":"Add User")+"\n            ")]),e._v(" "),t(l.c,[t(m.a,{ref:"UserForm",attrs:{"lazy-validation":""},model:{value:e.addFormValid,callback:function(t){e.addFormValid=t},expression:"addFormValid"}},[t(v.a,{attrs:{rules:[e.rules.required],outlined:"",dense:"",label:"Role",required:"",items:e.roleOptions},on:{change:e.handleRoleChange},model:{value:e.newUser.role,callback:function(t){e.$set(e.newUser,"role",t)},expression:"newUser.role"}}),e._v(" "),t(D.a,{attrs:{rules:[e.rules.required],outlined:"",dense:"",label:"Name",required:""},model:{value:e.newUser.name,callback:function(t){e.$set(e.newUser,"name",t)},expression:"newUser.name"}}),e._v(" "),t(D.a,{attrs:{rules:[e.rules.required,e.rules.email],outlined:"",dense:"",label:"Email",required:""},model:{value:e.newUser.email,callback:function(t){e.$set(e.newUser,"email",t)},expression:"newUser.email"}})],1)],1),e._v(" "),t(l.a,[t(w.a),e._v(" "),t(o.a,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeAddForm}},[e._v("Cancel")]),e._v(" "),t(o.a,{attrs:{color:"blue darken-1",text:"",disabled:!e.addFormValid},on:{click:e.saveUser}},[e._v("Submit")])],1)],1)],1),e._v(" "),t(h.a,{attrs:{"max-width":"400px"},model:{value:e.confirmDeleteDialog,callback:function(t){e.confirmDeleteDialog=t},expression:"confirmDeleteDialog"}},[t(n.a,[t(l.d,{staticClass:"headline centered-title",staticStyle:{"background-color":"#ff5722","margin-bottom":"1%"}},[e._v("\n            Confirm Deletion\n        ")]),e._v(" "),t(l.c,[e._v("\n            Are you sure you want to delete this User?\n        ")]),e._v(" "),t(l.a,[t(w.a),e._v(" "),t(o.a,{attrs:{color:"blue darken-1",text:""},on:{click:e.cancelDelete}},[e._v("Cancel")]),e._v(" "),t(o.a,{attrs:{color:"red darken-1",text:""},on:{click:e.confirmDelete}},[e._v("Delete")])],1)],1)],1),e._v(" "),t(h.a,{attrs:{"max-width":"400px"},model:{value:e.confirmCloseDialog,callback:function(t){e.confirmCloseDialog=t},expression:"confirmCloseDialog"}},[t(n.a,[t(l.d,{staticClass:"headline centered-title",staticStyle:{"background-color":"#ff5722","margin-bottom":"1%"}},[e._v("\n            Confirm Closing\n        ")]),e._v(" "),t(l.c,[e._v("\n            Are you sure you want to Close this User?\n        ")]),e._v(" "),t(l.a,[t(w.a),e._v(" "),t(o.a,{attrs:{color:"blue darken-1",text:""},on:{click:e.cancelClose}},[e._v("NO")]),e._v(" "),t(o.a,{attrs:{color:"red darken-1",text:""},on:{click:e.confirmClose}},[e._v("YES")])],1)],1)],1)],1):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);